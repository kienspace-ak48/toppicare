<style>
  .dt-layout-row {
    display: flex !important;
    flex-wrap: wrap !important;
    justify-content: space-between !important;
    align-items: center !important;
  }
  .dt-search label{
    display: none !important;
  }
  .dt-search input{
    
  }
</style>
<div class="flex justify-between items-center mb-5">
  <h3 class="text-xl font-bold">Posts/ Danh sách bài viết</h3>
  <button
    id="btn_cta_add_blog"
    class="font-bold text-white px-4 py-3 border border-gray-300 shadow bg-blue-500 rounded-lg"
  >
    <a href="/admin/blog/form-add">Add</a> +
  </button>
</div>
<div class="wrapper_table overflow-x-auto">
  <table id="blog_tbl" class="min-w-full text-sm text-center text-gray-600">
    <thead class="bg-gray-100 font-semibold text-gray-700 uppercase text-xs">
      <tr>
        <th class="px-6 py-4">Name</th>
        <th class="px-6 py-4">Slug</th>
        <th class="px-6 py-4">Image</th>
        <th class="px-6 py-4">Root</th>
        <th class="px-6 py-4">Category</th>
        <th class="px-6 py-4">Feature</th>
        <th class="px-6 py-4">Show</th>
        <th class="px-6 py-4 text-center">Action</th>
      </tr>
    </thead>
    <tbody class="divide-y divide-gray-100 text-left">
      <tr class="hover:bg-gray-50 transition">
        <td class="px-6 py-4">
          ToppiCare khai trương chi nhánh thứ 15 tại Hà Nội
        </td>
        <td class="px-6 py-4">
          toppicare-khai-truong-chi-nhanh-thu-15-tai-ha-noi
        </td>
        <td class="py-1">
          <img
            src="/uploads/imgs/img-slider_1-500564409.webp"
            alt=""
            style="width: 100px; height: 100px; object-fit: cover"
          />
        </td>
        <td class="px-6 py-4">69784602bbf9329335142977</td>
        <td class="px-6 py-4">False</td>
        <td class="px-6 py-4">
          <a href="/admin/blog/edit-blog/6979d128a3ff584903a5b1d6"
            ><button
              class="border border-gray-300 px-4 py-3 rounded-lg shadow hover:bg-gray-500 hover:text-white"
            >
              Edit
            </button></a
          >
          <button
            class="border border-gray-300 px-4 py-3 rounded-lg shadow hover:bg-gray-500 hover:text-white"
          >
            Delete
          </button>
        </td>
      </tr>
      <tr class="hover:bg-gray-50 transition">
        <td class="px-6 py-4">
          ToppiCare đồng hành cùng chương trình "Sức khỏe cộng đồng"
        </td>
        <td class="px-6 py-4">
          toppicare-dong-hanh-cung-chuong-trinh-suc-khoe-cong-dong
        </td>
        <td class="py-1">
          <img
            src="/uploads/imgs/img-slider_2-304254095.webp"
            alt=""
            style="width: 100px; height: 100px; object-fit: cover"
          />
        </td>
        <td class="px-6 py-4">69784602bbf9329335142977</td>
        <td class="px-6 py-4">True</td>
        <td class="px-6 py-4">
          <a href="/admin/blog/edit-blog/6979d128a3ff584903a5b1d6"
            ><button
              class="border border-gray-300 px-4 py-3 rounded-lg shadow hover:bg-gray-500 hover:text-white"
            >
              Edit
            </button></a
          >
          <button
            class="border border-gray-300 px-4 py-3 rounded-lg shadow hover:bg-gray-500 hover:text-white"
          >
            Delete
          </button>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<!-- SCRIPT -->
<script>
  var blogTable = null;
  blogTable = new DataTable("#blog_tbl", {
    ajax: {
      url: "/admin/blog/get-all",
      dataSrc: "data",
    },
    layout: {
    topStart: 'pageLength',
    topEnd: 'search',
    bottomStart: 'info',
    bottomEnd: 'paging'
  },
    info: false,
    columns: [
      { data: "title", render: (v) => `<p class="line-clamp-2 px-4 py-6 ">${v}</p>` },
      { data: "slug", render: (v) => `<p class="line-clamp-2 px-4 py-6">${v}</p>` },
      {
        data: "img",
        render: (v) => `<div class="py-1">
          <img
            src="/${v}"
            alt=""
            style="width: 80px; height: 80px; object-fit: cover"
          />
        </div>`,
      },
      { data: "category_id", render: (v) => `<p class="text-center  px-4 py-6">${v.category_root}</p>` },
      { data: "category_id", render: (v) => `<p class="text-center px-4 py-6">${v.name}</p>` },
      { data: "isFeatured", render: (v) => `<p class="text-center px-4 py-6">${v}</p>` },
      { data: "status", render: (v) => `<p class="text-center px-4 py-6">${v}</p>` },
      {
        data: null,
        render: (data, type, row) =>
          `<p class="text-center">
            <a href="/admin/blog/edit-blog/${row._id}"
            ><i class="fa-solid fa-pen-to-square hover:text-blue-600"></i></a
          >
          <i class="fa-solid fa-trash-can btn_delete_blog hover:text-blue-600"></i>
            </p>`,
      },
    ],
  });
  //

  const blogTbodyTable = document.querySelector("#blog_tbl tbody");
  blogTbodyTable.addEventListener("click", function (ev) {
    const btnDelete = ev.target.closest(".btn_delete_blog");
    if (!btnDelete) return;

    //lay row hien tai
    const tr = btnDelete.closest("tr");
    const rowData = blogTable.row(tr).data();

    console.log(rowData);
    // alert(rowData._id)
    confirmDelete(rowData._id);
  });
  function deleteBlog(id) {
    fetch(`/admin/blog/delete-blog/${id}`, {
      method: "DELETE",
      headers: {
        "Content-Type": "application/json",
      },
    })
      .then((res) => res.json())
      .then((res) => {
        console.log(res);
        if (res.success) {
          myNotification("delete success", "success");
          blogTable.ajax.reload(null, false);
        }
      })
      .catch((err) => console.log(err));
  }
  //
  function confirmDelete(id) {
    if(!id) return;
    Swal.fire({
      title: "Are you sure?",
      // text: "You won't be able to revert this!",
      icon: "warning",
      showCancelButton: true,
      confirmButtonColor: "#3085d6",
      cancelButtonColor: "#d33",
      confirmButtonText: "Yes, delete it!",
    }).then((result) => {
      if (result.isConfirmed) {
        // Swal.fire({
        //   title: "Deleted!",
        //   text: "Your file has been deleted.",
        //   icon: "success"
        // });
        deleteBlog(id);
      }
    });
  }
</script>
